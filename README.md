# java-filmorate
Template repository for Filmorate project.
## Спринт №11.1 (промежуточное ТЗ)
<details> <summary> Техническое задание </summary>  

### Задание для взаимопроверки
Сейчас Filmorate хранит все данные в своей памяти. Это приводит к тому, что при перезапуске приложения его история и настройки сбрасываются. Вряд ли это обрадует пользователей!   
Итак, нам нужно, чтобы данные:
- были доступны всегда,
- находились в актуальном состоянии.

А ещё важно, чтобы пользователи могли получать их быстро. Для этого вся информация должна храниться в базе данных.   
В этом задании вы будете проектировать базу данных для проекта, основываясь на уже существующей функциональности. Вносить какие-либо изменения в код не потребуется.  
Готовое решение отправьте своему партнёру по взаимопроверке из группы.

*Если ваша работа не пройдёт проверку одногруппником, то ревьюер потратит одну попытку сдачи финального задания следующего спринта на проверку ER диаграммы, и у вас будет меньше попыток сдачи проекта Filmorate.*

<details> <summary> Как проходит взаимопроверка </summary>  

### Загрузите решение
Начните с загрузки файла с решением в ваш репозиторий на GitHub. Затем пригласите партнёра по взаимопроверке в приватный репозиторий — сделать это можно через меню Collaboration (англ. «сотрудничество»).  
Откройте настройки репозитория и введите логин партнёра: Settings → Repositories → Manage access → Invite a collaborator. Теперь отправьте ссылку на ваше решение одногруппнику в Пачке.

*Решение нужно отправить не позднее указанного дедлайна. Когда проверка будет выполнена, не забудьте исключить одногруппника из репозитория — иначе у него останется полный доступ.*

### Проверьте работу одногруппника
Вы получили ссылку на репозиторий одногруппника — теперь можно оставлять комментарии к коду. Убедитесь, что код отвечает требованиям задания и code style, принятому в Практикуме.  
Ревью — ответственная задача. Представьте себя на месте другого студента и подумайте, какая обратная связь была бы наиболее полезна для него.  
Идеальный комментарий содержит:
- Мягкие формулировки. Постарайтесь не использовать слово «нужно» (альтернатива — «лучше») и повелительное наклонение («сделай»). Лучше не перекладывать работу кода на его автора — «этот код делает» вместо «ты делаешь».
- Развёрнутые объяснения.
- Обоснование необходимости другого решения.
- Встречные предложения — как сделать лучше.
- Поясняющие ссылки на статьи и обсуждения.

Например: *Здесь лучше использовать вот это — оно реализует такой-то функционал. А то работает медленнее.
[Пример кода. Поясняющая ссылка.]*

### Оцените обратную связь
По результатам ревью оцените, насколько полезные комментарии вы получили. Это поможет вашему партнёру быть более конструктивным ревьюером.  
Поделиться своими ощущениями от ревью вы можете в канале #java_neformal.
</details>

### Изучение теории
Прочтите следующие статьи, чтобы узнать, как проектировать базы данных:
- «Нормализация баз данных простыми словами»,
- «Ненормализованная форма или нулевая нормальная форма (UNF) базы данных»,
- «Первая нормальная форма (1NF) базы данных»,
- «Вторая нормальная форма (2NF) базы данных»,
- «Третья нормальная форма (3NF) базы данных».

Или посмотрите первые 19 минут видео «Нормальные формы баз данных: Объясняем на пальцах» — оно полностью дублирует статьи.

Если вам захочется бросить себе вызов, советуем прочитать статьи на английском:
- «What is Normalization in DBMS (SQL)? 1NF, 2NF, 3NF, BCNF Database with Example»,
- «Normal Forms in DBMS».

Это поможет набрать словарь технических терминов, который пригодится вам в будущем для чтения документации.

### Доработка модели
Прежде чем приступить к созданию схемы базы данных, нужно доработать модель приложения. Сейчас сущности, с которыми работает Filmorate, имеют недостаточно полей, чтобы получилось создать полноценную базу. Исправим это!

#### Film
1. Добавьте новое свойство — «жанр». У фильма может быть сразу несколько жанров, а у поля — несколько значений. Например, таких:
- Комедия.
- Драма.
- Мультфильм.
- Триллер.
- Документальный.
- Боевик.
2. Ещё одно свойство — рейтинг Ассоциации кинокомпаний (англ. Motion Picture Association, сокращённо МРА). Эта оценка определяет возрастное ограничение для фильма. Значения могут быть следующими:
- G — у фильма нет возрастных ограничений,
- PG — детям рекомендуется смотреть фильм с родителями,
- PG-13 — детям до 13 лет просмотр не желателен,
- R — лицам до 17 лет просматривать фильм можно только в присутствии взрослого,
- NC-17 — лицам до 18 лет просмотр запрещён.

#### User
1. Добавьте статус для связи «дружба» между двумя пользователями:
2. неподтверждённая — когда один пользователь отправил запрос на добавление другого пользователя в друзья,
3. подтверждённая — когда второй пользователь согласился на добавление.

### Создание схемы базы данных
Начните с таблиц для хранения пользователей и фильмов. При проектировании помните о том, что:
- Каждый столбец таблицы должен содержать только одно значение. Хранить массивы значений или вложенные записи в столбцах нельзя.
- Все неключевые атрибуты должны однозначно определяться ключом.
- Все неключевые атрибуты должны зависеть только от первичного ключа, а не от других неключевых атрибутов.
- База данных должна поддерживать бизнес-логику, предусмотренную в приложении. Подумайте о том, как будет происходить получение всех фильмов, пользователей. А как — топ N наиболее популярных фильмов. Или список общих друзей с другим пользователем.

Теперь нарисуйте схему базы данных. Для этого можно использовать любой из следующих инструментов:
1. dbdiagram.io.
2. QuickDBD.
3. Miro.
4. Lucidchart.
5. Diagrams.net.

### Последние штрихи
Прежде чем отправлять получившуюся схему на проверку:
1. Скачайте диаграмму в виде картинки и добавьте в репозиторий. Убедитесь, что на изображении чётко виден текст.
2. Добавьте в файл README.md ссылку на файл диаграммы. Если использовать разметку markdown, то схему будет видно непосредственно в README.md.
3. Там же напишите небольшое пояснение к схеме: приложите примеры запросов для основных операций вашего приложения.

#### *Подсказка*
*Документы по разметке, которая поддерживается GitHub, лежат здесь.*

Теперь можно отправлять схему на проверку и готовиться проверять работу одногруппника. Вы великолепны!
</details>  

![](/resourse/Diag_bd.png)

<details> <summary> Примеры запросов </summary>
Примеры запросов:  

<br> 1. Получение пользователя с ID = 1:  
  <br> SELECT * 
  <br> FROM Users
  <br> WHERE User_ID = 1;
<br>2. Получение фильма с ID = 1:  
 <br>  SELECT*  
 <br>  FROM Films  
 <br> WHERE Film_ID = 1;
<br> 3. Получение списка друзей пользователя с ID = 1:  
  <br> SELECT * 
  <br> FROM Friends
  <br> WHERE (User_ID = 1 OR Friend_ID = 1) 
<br> AND Status = 'CONFIRMED';
<br> 4. Получение списка лайков фильма с ID = 1:  
  <br> SELECT * 
  <br> FROM Likes
  <br> WHERE Film_ID = 1;
<br> 5. Получение списка общих друзей пользователей с ID = 1 и ID = 2:  
<br> (SELECT User_id AS Common_friend
<br> FROM Friends
<br> WHERE (Friend_ID = 2) 
<br> AND Status = 'Confirmed'
<br> UNION
<br> SELECT Friend_ID As Common_friend
<br> FROM Friends
<br> WHERE (User_ID = 2) 
<br> AND Status = 'Confirmed')
<br> INTERSECT
<br> (SELECT User_id AS Common_friend
<br> FROM Friends
<br> WHERE (Friend_ID = 1) 
<br> AND Status = 'Confirmed'
<br> UNION
<br> SELECT Friend_ID As Common_friend
<br> FROM Friends
<br> WHERE (User_ID = 1) 
<br> AND Status = 'Confirmed');
</details>